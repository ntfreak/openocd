source [find target/atheros_ar9331.cfg]

# ar9331_25mhz_pll_init is imported from tcl/board/tp-link_tl-mr3020.cfg
proc ar9331_25mhz_pll_init {} {
        mww 0xb8050008 0x00018004        ;# bypass PLL; AHB_POST_DIV - ratio 4
        mww 0xb8050004 0x00000352        ;# 34000(ns)/40ns(25MHz) = 0x352 (850)
        mww 0xb8050000 0x40818000        ;# Power down control for CPU PLL
                                         ;# OUTDIV | REFDIV | DIV_INT
        mww 0xb8050010 0x001003e8        ;# CPU PLL Dither FRAC Register
                                         ;# (disabled?)
        mww 0xb8050000 0x00818000        ;# Power on | OUTDIV | REFDIV | DIV_INT
        mww 0xb8050008 0x00008000        ;# remove bypass;
                                         ;# AHB_POST_DIV - ratio 2
}

proc ar9331_ddr2_init {} {
        mww 0xb8000000 0x7fbc8cd0        ;# DDR_CONFIG - lots of DRAM confs
        mww 0xb8000004 0x9dd0e6a8        ;# DDR_CONFIG2 - more DRAM confs

        mww 0xb800008c 0x00000a59
        mww 0xb8000010 0x00000008
        mww 0xb8000090 0x00000000
        mww 0xb8000010 0x00000010
        mww 0xb8000094 0x00000000
        mww 0xb8000010 0x00000020
        mww 0xb800000c 0x00000000
        mww 0xb8000010 0x00000002
        mww 0xb8000008 0x00000100
        mww 0xb8000010 0x00000001
        mww 0xb8000010 0x00000008
        mww 0xb8000010 0x00000004
        mww 0xb8000010 0x00000004
        mww 0xb8000008 0x00000a33
        mww 0xb8000010 0x00000001
        mww 0xb800000c 0x00000382
        mww 0xb8000010 0x00000002
        mww 0xb800000c 0x00000402
        mww 0xb8000010 0x00000002
        mww 0xb8000014 0x00004186
        mww 0xb800001c 0x00000008
        mww 0xb8000020 0x00000009
        mww 0xb8000018 0x000000ff
}

$TARGETNAME configure -event reset-init {
        ar9331_25mhz_pll_init
        sleep 1
        ar9331_ddr2_init
}

set ram_boot_address 0xa0000000
$TARGETNAME configure -work-area-phys 0xa1ffe000 -work-area-size 0x1000
