# Embedded Artists eval board for LPC3250
# http://www.embeddedartists.com/

source [find target/lpc3250.cfg]

adapter_nsrst_delay 200
jtag_ntrst_delay 1
adapter_khz 200
reset_config trst_and_srst separate

$_TARGETNAME configure -event gdb-attach { reset init }

$_TARGETNAME configure -event reset-start {
             arm7_9 fast_memory_access disable
             adapter_khz 200
}

$_TARGETNAME configure -event reset-end {
	     adapter_khz 6000
             arm7_9 fast_memory_access enable
}

$_TARGETNAME configure -event reset-init { ea_lpc3250_init }

# initialization script
proc ea_lpc3250_init { } {

	# configure clocks
        #  ARMCLK    = 266.5 MHz
        #  HCLK      = 133.25 MHz
        #  PERIPHCLK = 13.325 MHz
        mww 0x40004050 0x00000140
        mww 0x40004058 0x00014251
        mww 0x40004040 0x000000CD

        # initialize PLL
        mww 0x40004044 0x00000016
        sleep 1
        mww 0x40004044 0x00000116
        sleep 1
        mww 0x40004044 0x00000016
        sleep 1
        mww 0x40004048 0x00000401

	# remaps IRAM to address 0x00000000
        mww 0x40004014 0x00000001
}
