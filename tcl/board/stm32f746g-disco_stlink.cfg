# This is an STM32F746G discovery board with a single STM32F746NGH6 chip.
# http://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mcu-eval-tools/stm32-mcu-eval-tools/stm32-mcu-discovery-kits/32f746gdiscovery.html

# This is for using the onboard STLINK/V2-1
source [find interface/stlink-v2-1.cfg]

transport select hla_swd

# increase working area to 256KB
set WORKAREASIZE 0x40000

source [find target/stm32f7x.cfg]

$_TARGETNAME configure -event reset-init {
    # QUADSPI initialization

	mmw 0x40023830 0x000007FF 0	;# RCC_AHB1ENR |= GPIOA-GPIOK (enable clocks)
	mmw 0x40023838 0x00000002 0	;# RCC_AHB3ENR |= QSPIEN (enable clock)
	sleep 1						;# Wait for clock startup

    # PB2: CLK, PB6: BK1_nCS, PD13: BK1_IO3, PE2: BK1_IO2, PD12: BK1_IO1, PD11: BK1_IO0
	mmw 0x40020400 0x00002020 0x00001010	;# PB6, PB2 alternate
	mmw 0x40020408 0x00003030 0x00000000	;# high speed
	mmw 0x40020420 0x0A000900 0x05000600	;# AF10, AF9

	mmw 0x40020C00 0x0A800000 0x05400000	;# PD13, PD12, PD11 alternate
	mmw 0x40020C08 0x0FC00000 0x00000000	;# high speed
	mmw 0x40020C24 0x00999000 0x00666000	;# AF9, AF9, AF9

	mmw 0x40021000 0x00000020 0x00000010	;# PE2 alternate
	mmw 0x40021008 0x00000030 0x00000000	;# high speed
	mmw 0x40021020 0x00000900 0x00000600	;# AF9

	mww 0xA0001004 0x00170100	;# QUADSPI_DCR: FSIZE=0x17, CSHT=0x01, CKMODE=0
	mww 0xA0001000 0x01500318	;# QUADSPI_CR: PRESCALER=1, APMS=1, FTHRES=3, SSHIFT=1, TCEN=1
	mww 0xA0001014 0x0D002503	;# QUADSPI_CCR: FMODE=0x3, DMODE=0x1, DCYC=0x0, ADSIZE=0x3, ADMODE=0x1, IMODE=0x1
	mmw 0xA0001000 0x00000001 0	;# QUADSPI_CR: EN=1
}
