# Renesas R-Car E2

if { [info exists CHIPNAME] } {
	set _CHIPNAME $CHIPNAME
} else {
	set _CHIPNAME r8a7794
}

# Coresight Debug Access Port
if { [info exists DAP_TAPID] } {
	set _DAP_TAPID $DAP_TAPID
} else {
	set _DAP_TAPID 0x4ba00477
}

reset_config trst_and_srst srst_nogate
adapter_khz 1000

jtag newtap $_CHIPNAME dap -irlen 4 -ircapture 0x01 -irmask 0x0f -expected-id $_DAP_TAPID

set _TARGETNAME_CA7 $_CHIPNAME.ca7.
target create ${_TARGETNAME_CA7}0 cortex_a -chain-position $_CHIPNAME.dap -coreid 0 -dbgbase 0x800F0000
#target create ${_TARGETNAME_CA7}1 cortex_a -chain-position $_CHIPNAME.dap -coreid 1 -dbgbase 0x800F2000

${_TARGETNAME_CA7}0 configure -event reset-assert-post { cortex_a dbginit }
${_TARGETNAME_CA7}0 configure -event gdb-attach { halt }
#${_TARGETNAME_CA7}1 configure -event reset-assert-post { cortex_a dbginit }
#${_TARGETNAME_CA7}1 configure -event gdb-attach { halt }

#target smp ${_TARGETNAME_CA7}0 ${_TARGETNAME_CA7}1

proc init_reset {mode} {
    # Assert both resets: equivalent to a power-on reset
    jtag_reset 1 1

    # Deassert TRST to begin TAP communication
    jtag_reset 0 1

    # TAP should now be responsive, validate the scan-chain
    jtag arp_init
}
