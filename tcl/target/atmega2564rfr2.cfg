set _CHIPNAME avr
set _ENDIAN little

# jtag speed
adapter speed 4500

reset_config srst_only
adapter_nsrst_delay 100

#jtag scan chain
if { [info exists CPUTAPID] } {
   set _CPUTAPID $CPUTAPID
} else {
   set _CPUTAPID 0x0a80303f
}
jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID

set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME avr -endian $_ENDIAN -chain-position $_TARGETNAME

set _FLASHNAME $_CHIPNAME.flash
set _FLASHNAMEEEPROM $_CHIPNAME.eeprom
set _FLASHNAMEFUSES $_CHIPNAME.fuses
set _FLASHNAMEUSER_SIG $_CHIPNAME.user_signature

flash bank $_FLASHNAME avr 0 0x40000 0 0 $_TARGETNAME 0
flash bank $_FLASHNAMEEEPROM avr_eeprom 0 0x2000 0 0 $_TARGETNAME 0
flash bank $_FLASHNAMEFUSES avr_fuses 0 0x3 0 0 $_TARGETNAME 0
flash bank $_FLASHNAMEUSER_SIG avr_user_signature 0 0x3072 0 0 $_TARGETNAME 0

