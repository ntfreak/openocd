# Ingenic JZ4730 (XBurst MIPS32r1-compatibe core)

set  WDT_BASE_ADDR              0xb0004000
set  WDT_WTCSR                  [expr   $WDT_BASE_ADDR  + 0x00]
set  WDT_WTCNT                  [expr   $WDT_BASE_ADDR  + 0x04]

if { [info exists CHIPNAME] } {
	set _CHIPNAME $CHIPNAME
} else {
	set _CHIPNAME jz4730
}

if { [info exists CPUTAPID] } {
	set _CPUTAPID $CPUTAPID
} else {
	set _CPUTAPID 0x0000024f
}

jtag newtap $_CHIPNAME cpu -irlen 5 -ircapture 0x1 -irmask 0x1f -expected-id $_CPUTAPID

set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME mips_m4k -endian little -chain-position $_TARGETNAME
$_TARGETNAME mips_m4k xburst_btb

proc reboot { } {
	global WDT_WTCNT
	global WDT_WTCSR

	# Make it overflow in 32 ticks
	mww phys $WDT_WTCNT			0xffffffdf

	# Start it
	mwb phys $WDT_WTCSR			0x10
}
